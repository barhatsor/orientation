<!DOCTYPE html>
<html>
<head>
<style>

html, body {
  font-family: system-ui;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0;
}

</style>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover,shrink-to-fit=no">
</head>
<body ontouchstart>
<div class="log">Allow access to try orientation.</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/101/three.min.js"></script>
<script src='GenericFuncs.js'></script>
<script src='DeviceOrientationController.js'></script>
<script src='MotionHelper.js'></script>
<script src='RotationHelper.js'></script>
<script src='main.js'></script>
<script src='estimation.js'></script>


<script>

const logEl = document.querySelector('.log');

document.documentElement.addEventListener('click', async () => {
  
  logEl.innerHTML = '<a style="font-size: 90px">âž¤</a>';

  let permissiona;
  
  try {
    
    permissiona = await DeviceMotionEvent.requestPermission();
    
  } catch (err) {
    
    logEl.textContent = 'No orientation access';
    
  }
  
  if (permissiona !== 'granted') {
    
    logEl.textContent = 'No orientation access';
    
  }

  OrientationGrantedFlag = true;
  
  logEl.textContent = 'Got orientation!';

  window.addEventListener('deviceorientation', onDeviceOrientation);
  
});

/*
function onDeviceOrientation(e) {
  
  //logEl.textContent = e.alpha + 'deg';
  logEl.style.rotate = e.alpha + 'deg';
  
}
*/

function onDeviceOrientation(e) {
  
  const compassHeading = GetCompassHeading(e.alpha, event.beta, event.gamma);
  
  if (compassHeading) {
    
    window.dispatchEvent(new CustomEvent('rotation-is-set', {
      detail: {
        compass_reading: compassHeading
      }
    }));
    
  }
  
}

</script>

</body>
</html>