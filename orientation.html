<!DOCTYPE html>
<html>
<head>
<style>



html, body {
  font-family: system-ui;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-flow: column;
  margin: 0;
}


.eta {
  margin-bottom: -20px;
  margin-top: 20px;
}


.log {
  font-variant-numeric: tabular-nums;
}


canvas {
  pointer-events: none;
}


</style>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover,shrink-to-fit=no">
</head>

<body ontouchstart>

<div class="init">Allow access to try orientation.<br></div>
<br>
<div class="eta"></div>
<br>
<div class="log">
<div></div>
<br>
<div></div>
</div>
<br>

<div class="arrow-wrapper"><div class="arrow" style="font-size: 90px;rotate: -90deg">âž¤</div></div>


<script src="three.min.js"></script>
<script src="RotationHelper.js"></script>
<script src="DeviceOrientationController.js"></script>
<script src="MotionHelper.js"></script>
<script src="main.js"></script>
<script src="estimation.js"></script>


<script>

const arrowEl = document.querySelector('.arrow-wrapper');

const initEl = document.querySelector('.init');
const eta = document.querySelector('.eta');

const logEl = document.querySelector('.log');


const testCrds = {
  lat: 31.335863941913445,
  lon: 34.89715622159005
};

document.documentElement.addEventListener('click', async () => {

  let motionPermission;
  
  try {
    
    motionPermission = await DeviceMotionEvent.requestPermission();
    
  } catch (err) {
    
    initEl.innerText = 'No orientation access';
    
  }
  
  if (motionPermission !== 'granted') {
    
    initEl.innerText = 'No orientation access';
    
  }

});


window.addEventListener('deviceorientation', onDeviceOrientation);


function onDeviceOrientation(e) {
  
  initEl.style.display = 'none';
  
  
  const resp = estimation(testCrds, positionGPS);
  
  if (Math.abs(resp.aspect.z) > 100) {
    
    // the location's behind us
    
  } else {
    
    arrowEl.style.rotate = -resp.aspect.y.toFixed(1) + 'deg';
    
    let time = Number(resp.walkDist).toFixed(0);
    
    if (time >= 60) {
      
      const hours = (time/60).toFixed(0);
      
      let min = time - hours*60;
      
      if (min > 0) min = ', ' + min + ' min';
      else min = ''
      
      time = hours + ' hr' + min;
      
    } else {
      
      if (time > 0) time = time + ' min';
      else time = 'You\'re here!';
      
    }
    
    eta.textContent = time;
  
  }

}

</script>

</body>
</html>
